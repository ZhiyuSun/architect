# 模块分解

## 领域驱动设计驱动系统重构

软件开发是一个过程，这个过程中相关方对软件系统的认知会不断改变，当系统现状和大家的认知有严重冲突的时候，不重构系统难
以继续开发下去。

在持续的需求迭代过程中，代码本身会逐渐腐坏，变得僵硬、脆弱、难以维护，需求开发周期越来越长，bug却越来越多。

### 领域驱动设计关键术语

领域：一个组织所做的事情以及其包含的一切，通俗地说，就是组织的业务范围和做事方式，也是软件开发的目标范围。

子域：领域是一个组织所做的事情以及其包含的一切。这个范围就太大了，不知道该如何下手。所以通常的做法是把整个领域拆分成多个子域，比如用户、商品、订单、库存、物流、发票等。

限界上下文：在一个子域中，会创建一个概念上的领域边界，在这个边界中，任何领域对象都只表示特定于该边界内部的确切含义。这样边界便称为限界上下文。限界上下文通常和子域具有一对一的关系，用来控制子域的边界，保证子域内的概念统一性。

上下文映射图：不同的限界上下文，也就是不同子域之间会有各种的交互合作。DDD 使用上下文映射图来设计这种关联和交互。

实体：领域模型对象也被称为实体，每个实体都是唯一的，具有一个唯一标识，一个订单对象是一个实体，一个产品对象也是一个实体，订单ID 或者产品ID 是它们的唯一标识。实体可能会发生变化，比如订单的状态会变化，但是它们的唯一标识不会变化。

值对象：并不是领域内的对象都应该被设计为实体，DDD 推荐尽可能将对象设计为值对象。比如像住址这样的对象就是典型的值对象。

聚合：聚合是一个关联领域对象的集合，我们将其作为一个单元来处理数据更改。每个集合都有一个根和一个边界。边界定义了聚合内部的内容。根是聚合中包含的单个特定实体。

### 总结

当前系统设计与问题汇总讨论
- 架构与代码混乱，需求迭代困难，部署麻烦，bug率逐渐升高

针对问题分析具体原因
- 微服务A太庞大，微服务B和C职责不清，团队内业务理解不一致，内部代码设计不良，硬编码和耦合太多

重新梳理业务流程，明确业务术语，进行DDD战略设计
- （泳道）活动图、子域分解、限界上下文设计

针对当前系统实现和DDD设计不匹配的地方设计微服务重构方案
DDD战术设计与技术验证
- 聚合、实体、值对象设计，打样代码开发

任务分解与持续重构
- 在不影响业务开发的前提下，按照战略与战术设计，将重构开发和业务迭代有机融合