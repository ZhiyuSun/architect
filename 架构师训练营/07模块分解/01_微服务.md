# 模块分解

## 微服务

### 巨无霸系统带来的问题

编译、部署困难：
- 对于网站开发工程师而言，打包构建一个巨型应用是一件痛苦的事情。
- 也许只是修改了一行代码，输入build 命令后，抽完一支烟，回来一看，还在building；
- 又去喝了一杯水，回来一看，还在building；又去了一次厕所，回来一看，还在building；
- 好不容易build 结束，一看编译失败，还得重来…
- 想砸了显示器有木有？

代码分支管理困难：
- 复用的代码模块由多个团队共同维护修改，代码merge 的时候总会发生冲突。代码merge 一般在网站发布的时候，和发布等问题互相纠结在一起，顾此失彼，每次发布都要半夜三更。

数据库连接耗尽：
- 巨型的应用、大量的访问，必然需要将这个应用部署在一个大规模的服务器集群上，应用与数据库的连接通常使用数据库连接池，以每个应用10个连接计，一个数百台服务器集群的应用将需要在数据库上创建数千个连接，数据库服务器上，每个连接都会占用一些昂贵的系统资源，以至于数据库缺乏足够的系统资源进行一般的数据操作。

新增业务困难：
- 想要在一个已经如乱麻般系统中增加新业务，维护旧功能，难度可想而知.
- 一脚踩进去，发现全都是雷，什么都不敢碰。许多新工程师来公司半年了，还是不能接手业务，因为不知道水有多深。
- 于是就出现这种怪现象：熟悉网站产品的“老人”忙得要死，加班加点干活；不熟悉网站产品的新人一帮忙就出乱，跟着加班加点；
- 整个公司热火朝天，加班加点，却还是经常出故障，新产品迟迟不能上线。

解决方案就是拆分，将模块独立部署，降低系统耦合性：
- 纵向拆分：将一个大应用拆分为多个小应用，如果新增业务较为独立，那么就直接将其设计部署为一个独立的Web应用系统。
- 横向拆分：将复用的业务拆分出来，独立部署为微服务，新增业务只需要调用这些微服务即可快速搭建一个应用系统。

### 微服务框架

#### Web Service 与企业级分布式服务

服务提供者通过WSDL（Web服务描述语言，Web Services Description Language）向注册中心（Service Broker）描述自身提供的服务接口属性，注册中心使用UDDI（Universal Description, Discovery, and Integration，统一描述、发现和集成）发布
服务提供者提供的服务，服务请求者从注册中心检索到服务信息后，通过SOAP（Simple Object Access Protocol，简单对象访问协议）和服务提供者通信，使用相关服务。

Web Service 虽然有着成熟的技术规范和产品实现，以及在企业应用领域有许多成功的案例，但是也具有一些固有的缺点：
- 臃肿的注册与发现机制
- 低效的XML 序列化手段
- 开销相对较高的HTTP 远程通信
- 复杂的部署与维护手段

这些问题导致Web Service 难以满足大型网站对系统高性能、高可用、易部署、易维护的要求。

#### 微服务框架需求

对于大型互联网系统，除了Web Service 所规范的服务注册与发现，服务调用等标准功能，还需要微服务框架能够支持：

负载均衡：
- 对于集群部署的服务提供者，服务请求者可以使用加权轮询等手段访问，使服务提供者集群实现负载均衡。

失效转移（Fail Over）：
- 对于大型网站的微服务而言，即使是很少访问的简单服务，也需要集群部署，同时微服务框架还需要支持服务提供者的失效转移机制，以实现服务高可用。

高效的远程通信：
- 对于大型网站，核心服务每天的调用次数会达到数以亿计，如果没有高效的远程通信手段，服务调用可能会成为整个系统性能的瓶颈。

对应用最少侵入：
- 网站技术是为业务服务的，是否使用微服务需要根据业务发展规划，微服务也需要渐进式的演化，甚至会出现反复，即使用了微服务后又退回到集中式部署，微服务框架需要支持这种渐进式演化和反复。当然服务模块本身需要支持可集中式部署，也可分布式部署。

版本管理：
- 为了应对快速变化的需求，服务版本升级不可避免，如果仅仅是服务实现升级，那么这种升级对服务请求者而言是透明的，无需关注。但是如果服务的访问接口发生变化，就需要服务请求者和服务提供者同时升级才不会导致服务调用失败。企业应用系统可以申请停机维护，
同时升级接口，而网站服务不可能中断，需要服务提供者先升级接口，并同时提供历史版本的服务供请求者调用，当请求者访问接口升级后才可以关闭历史版本服务。

#### 微服务框架（Dubbo）架构

