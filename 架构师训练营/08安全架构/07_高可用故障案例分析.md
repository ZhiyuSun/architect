# 安全架构

## 高可用故障案例分析


### 日志级别

经验教训:
- 检查log 配置文件，日志输出级别至少为Warn，并且检查log 输出代码调用，调用
级别要符合其真实日志级别。
- 有些开源的第三方组件也会不恰当地输出太多的Error 日志，需要关闭这些第三方库
的日志输出，至于哪些第三方库有问题，只有在遇到问题时才知道。
- 应用程序自己的日志输出配置和第三方组件日志输出要分别配置。

### sql频繁

经验教训:
- 首页不应该访问数据库，首页需要的数据可以从缓存服务器或者搜索引擎服务器获取。
- 首页最好是静态的。

### 不定时响应超时

经验教训:
- 使用锁操作要谨慎，特别注意在有锁的方法中进行长时间的IO 操作的时候。
- 针对使用锁的不同场景，使用不同锁对象，而不是简单的在所有方法上都加上synchronized

### 数据库服务突然load升高

经验教训:
- 当缓存已经不仅仅是改善性能，而是成为网站架构不可或缺的一部分时，对缓存的管理就需要提高到和其他服务器一样的级别。

### 滥用生产环境

经验教训:
- 访问线上生产环境要规范，不小心就会导致大事故。
- 滥用生产环境的一个例子：网站数据库有专门的DBA 维护，如果发现数据库存在错误记录，需要进行数据订正，必须走数据订正流程，申请DBA 协助。于是就有工程师为避免麻烦，直接写一段数据库更新操作的代码，悄悄放到生产环境应用服务器上执行，神不知鬼不觉地订正了数据。但是如果不小心写错了SQL，后果可想而知。

### NPE

经验教训:
- 程序在处理一个输入的对git 象时，如果不能明确该对象是否为空，必须做空指针判断。
- 程序在调用其他方法时，输入的对象尽量保证不是null，必要时构造空对象（使用空
对象模式）。