# 性能优化

## 全链路压测

全链路压测其实指的就是在特定的业务场景下，将相关的链路完整的串联起来同时施压，尽可能模拟出真实的用户行为，当系统整站流量都被打上来的时候，必定会暴露出性能瓶颈，才能够探测出系统整体的真实处理能力，以及有指导的在大促前进行容量规划和性能优化，这便是线上实施全链路压测的真正目的。

## 全链路压测的挑战

- 压测相关的业务系统上众多，并且牵涉到整条链路上所有的基础设施和中间件，如何确保压测流量能够通畅无阻，没有死角？压测的数据怎么构造（亿万级的商品和用户），数据模型如何与真实贴近？
- 全链路压测直接在线上的真实环境进行模拟，怎么样来保障对线上无影响？
- 大型促销活动所带来的巨大流量要怎么样制作出来？

### 数据构造

### 数据隔离

逻辑隔离，直接把测试数据和正常数据写到一起，通过特殊的标识能够区分开。
- 可能污染线上数据，破坏线上数据安全性。

虚拟隔离，在所有写数据的地方做mock，并不真正的写进去。
- 这个方案不会对线上产生污染，但是mock 对压测结果的准确性会产生干扰。

物理隔离，所有写数据的地方对压测流量进行识别，判断一旦是压测流量的写，就写到隔离的位置，包括存储、缓存、搜索引擎等等。

### 流量构造

天猫双十一全链路压测的流量平台是一个典型的master＋slave 结构，master 作为压测管控台管理着上千个slave 节点；slave 节点作为压测引擎，负责具体的请求发送。

Master 作为整个压测平台的大脑，负责的整个平台的运转控制、命令发送、数据收集、决策等。Slave 节点部署在全球各地的cdn 节点上，从而模拟从全球各地过来的用户请求。整套全链路压测的流量平台在压测过程当中平稳输出1000+w/s的用户请求、同时保持过亿的无线用户长链接。

## 全链路压测平台化

