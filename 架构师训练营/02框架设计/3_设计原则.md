# 框架设计

## 2.3 开闭原则介绍及代码分析

### OOD原则一：开闭原则（OCP）

OCP － Open/Closed Principle
- 对于扩展是开放的（Open for extension）
- 对于更改是封闭的（Closed for modification）
- 简言之：不需要修改软件实体（类、模块、函数等），就应该能实现功能的扩展。

传统的扩展模块的方式就是修改模块的源代码。如何实现不修改而扩展呢？
- 关键是抽象！

## 2.4 依赖倒置原则介绍及代码案例分析

### OOD原则二：依赖倒置原则（DIP）

DIP － Dependency Inversion Principle
- 高层模块不能依赖低层模块，而是大家都依赖于抽象；
- 抽象不能依赖实现，而是实现依赖抽象。

DIP 倒置了什么？
- 模块或包的依赖关系
- 开发顺序和职责

软件的层次化
- 高层决定低层
- 高层被重用

#### 框架的核心

好莱坞规则：
• Don't call me, I'll call you.
倒转的层次依赖关系

知鱼君注：框架去实现接口

#### 找出Button 背后的抽象

Button 的本质是什么？
- 检测用户的按键指令，并传递给目标对象
用什么机制检测用户的按键？
- 不重要
目标对象是什么？
- 不重要

李老师：不能用依赖倒置原则去知道开发，就不是一个合格的架构师，架构师会纠结于程序设计的细节，或者设计出来的系统，就没有一个整体的框架，整体的结构来完成，代码设计就会越来越混乱，而框架可以框清这一切，而框架就是靠依赖倒置原则。

## 2.5 里氏替换原则

### OOD 原则三：Liskov替换原则（LSP）

在Java/C++ 这样的静态类型语言中，实现OCP 的关键在于抽象，而抽象的威力在于多
态和继承。
- 一个正确的继承要符合什么要求呢？
- 答案：Liskov 替换原则

1988年，Barbara Liskov 描述这个原则：
- 若对每个类型T1 的对象o1，都存在一个类型T2 的对象o2，使得在所有针对T2 编写的程
序P 中，用o1 替换o2 后，程序P 的行为功能不变，则T1 是T2 的子类型。
- 简言之：子类型（subtype）必须能够替换掉它们的基类型（base type）。

#### 从契约的角度来看LSP

LSP 要求，凡是使用基类的地方，一定也适用于其子类。
从Java 语法角度看，意味着：
- 子类一定得拥有基类的整个接口。
- 子类的访问控制不能比基类更严格。
    - 例如，Object 类中有一个方法：
        - protected Object clone();
    - 子类中可以覆盖（override）之并放松其访问控制 
        - public Object clone();
    - 但反过来是不行的，例如：
        - 覆盖public String toString() 方法，并将其访问控制缩小成private，编译器不可能允许这样的代码通过编译。
从更广泛的意义来看，子类的“契约”不能比基类更“严格”
- 例如，正方形长宽相等，这个契约比长方形要严格，因此正方形不是长方形的子类。
- 例如，Properties 的契约比Hashtable 更严格。

#### 继承vs. 组合

继承和组合是OOP 的两种扩展手段

继承的优点：
- 比较容易，因为基类的大部分功能可以通过继承直接进入子类。

继承的缺点：
- 继承破坏了封装，因为继承将基类更多的细节暴露给子类。因而继承被称为“白盒复用”。
- 当基类发生改变时，可能会层层影响其下的子类。
- 继承是静态的，无法在运行时改变组合。
- 类数量的爆炸。

应该优先使用组合

### 2.6 单一职责接口隔离

#### OOD 原则四：单一职责原则（SRP）

SRP － Single Responsibility Principle
- 又被称为“内聚性原则（Cohesion）”，意为：
    - 一个模块的组成元素之间的功能相关性。
- 将它与引起一个模块改变的作用力相联，就形成了如下描述：
    - 一个类，只能有一个引起它的变化的原因。

什么是职责？
- 单纯谈论职责，每个人都会得出不同的结论
- 因此我们下一个定义：
    - 一个职责是一个变化的原因。

#### OOD 原则五：接口分离原则（ISP）

ISP － Interface Segregation Principle
- 不应该强迫客户程序依赖它们不需要的方法。
ISP 和SRP 的关系
- ISP 和SRP 是相关的，都和“内聚性”有关。
- SRP 指出应该如何设计一个类—— 只能有一种原因才能促使类发生改变。
- ISP 指出应该如何设计一个接口—— 从客户的需要出发，强调不要让客户看到他们不需要
的方法。

